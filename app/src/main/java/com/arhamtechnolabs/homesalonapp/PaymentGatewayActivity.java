package com.arhamtechnolabs.homesalonapp;

import androidx.appcompat.app.AlertDialog;
import androidx.appcompat.app.AppCompatActivity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import android.app.Activity;
import instamojo.library.InstapayListener;
import android.app.Activity;
import android.app.Activity;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstamojoPay;
import instamojo.library.InstapayListener;
import instamojo.library.InstapayListener;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.Config;
import instamojo.library.InstamojoPay;
import instamojo.library.InstamojoPay;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;
import instamojo.library.Config;

import org.json.JSONArray;
import org.json.JSONObject;
import instamojo.library.Config;
import instamojo.library.Config;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONException;
import org.json.JSONObject;
import org.json.JSONObject;
import org.json.JSONException;
import org.json.JSONException;
import org.json.JSONException;
import org.json.JSONException;
import org.json.JSONException;

import android.content.Intent;
import android.content.IntentFilter;
import org.json.JSONException;
import org.json.JSONException;
import android.content.IntentFilter;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
import android.widget.TextView;
import android.widget.Toast;
import android.content.IntentFilter;
import android.content.IntentFilter;

import android.widget.Toast;
import android.os.Bundle;

import com.android.volley.AuthFailureError;
import com.android.volley.Request;
import com.android.volley.RequestQueue;
import com.android.volley.Response;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;
import com.android.volley.toolbox.Volley;
import com.arhamtechnolabs.homesalonapp.DataModel.DataHelper;
import com.arhamtechnolabs.homesalonapp.DataModel.DataTransferHelper;
import com.arhamtechnolabs.homesalonapp.DataModel.ListURL;
import com.arhamtechnolabs.homesalonapp.DataModel.SharedPreferenceHelper;

import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;
import java.util.HashMap;
import java.util.Map;
import java.util.Random;

public class PaymentGatewayActivity extends AppCompatActivity {


    String amountString, phone;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_payment_gateway);
        // Call the function callInstamojo to start payment here
        /*intent.putExtra("email", email);
                    intent.putExtra("phone", phone_no);
                    intent.putExtra("amount", String.valueOf(total));*/

        Intent intent = getIntent();
        String email = intent.getStringExtra("email");
         phone = intent.getStringExtra("phone");
         amountString = intent.getStringExtra("amount");

        callInstamojoPay(email, phone, amountString, "Booking of ammenities", "HomeSalon");

    }


    private void callInstamojoPay(String email, String phone, String amount, String purpose, String buyername) {
        final Activity activity = this;
        InstamojoPay instamojoPay = new InstamojoPay();
        IntentFilter filter = new IntentFilter("ai.devsupport.instamojo");
        registerReceiver(instamojoPay, filter);
        JSONObject pay = new JSONObject();
        try {
            pay.put("email", email);
            pay.put("phone", phone);
            pay.put("purpose", purpose);
            pay.put("amount", amount);
            pay.put("name", buyername);
            pay.put("send_sms", true);
            pay.put("send_email", true);
        } catch (JSONException e) {
            e.printStackTrace();
        }
        initListener();
        instamojoPay.start(activity, pay, listener);
    }

    InstapayListener listener;
    private void initListener() {
        listener = new InstapayListener() {
            @Override
            public void onSuccess(String response) {
                Toast.makeText(getApplicationContext(), response, Toast.LENGTH_LONG)
                        .show();

                makeEntryInBooking("OnlinePayment");

                ViewGroup viewGroup = findViewById(android.R.id.content);
                View dialogView = LayoutInflater.from(getApplicationContext()).inflate(R.layout.my_dialog, viewGroup, false);
//                AlertDialog.Builder builder = new AlertDialog.Builder(getApplicationContext());
//                builder.setView(dialogView);
//                final AlertDialog alertDialog = builder.create();
//                sendMsg(phone_no);
//                sendMsgOwner();

                PaymentActivity p = (PaymentActivity) getApplicationContext();
                p.sendMsg(phone);
                p.sendMsgOwner();
                Button buttonOk = dialogView.findViewById(R.id.buttonOk);
                TextView message = dialogView.findViewById(R.id.message);
                message.setText("Your booking is Successfull.");
               /* alertDialog.show();
                buttonOk.setOnClickListener(new View.OnClickListener() {
                    @Override
                    public void onClick(View view) {
                        alertDialog.dismiss();
                    }
                });*/

                Intent intent = new Intent(getApplicationContext(), ThankYouPageActivity.class);
                startActivity(intent);
                finish();
            }

            @Override
            public void onFailure(int code, String reason) {
                Toast.makeText(getApplicationContext(), "Failed: " + reason, Toast.LENGTH_LONG)
                        .show();
                Intent intent = new Intent(getApplicationContext(), MainActivity.class);
                startActivity(intent);
                finish();
            }
        };
    }

    private void makeEntryInBooking(String mode) {
        DataHelper dataHelper = new DataHelper(this);

        String category = dataHelper.categoryList();
        /*user_id date SubSubCat_ID amount payment_mode;*/
        String d = DataTransferHelper.dateOfBooking;
        String a = amountString;

        String address = DataTransferHelper.address;
        System.out.println("makeEntryAddress " + address);

        String t =  DataTransferHelper.timeOfBooking;
        String url = ListURL.BOOKING_INSERT_URL;
        String encodedUrl="";
        SharedPreferenceHelper helper = new SharedPreferenceHelper(getApplicationContext());
        String user_id =  helper.getUserId();

        try {
            //encodedUrl = URLEncoder.encode(address, "UTF-8");
            //address = encodedUrl;

            encodedUrl = URLEncoder.encode(category, "UTF-8");
            //category = encodedUrl;

        } catch (UnsupportedEncodingException e) {
            e.printStackTrace();
        }

        url+="user_id="+user_id+"&date="+d+"&SubSubCat_ID="+category+"&amount="+a+"&payment_mode="+mode+"&booking_time="+t+"&address="+address;
        // url+="user_id="+user_id+"&date="+d+"&SubSubCat_ID="+"sfsfz"+"&amount="+"sfesf"+"&payment_mode="+""+"&booking_time="+"fsf"+"&address="+"fsdfsf";
        url = url.replace(" ", "%20");
        url= url.replace(",", "%2C");

        Log.i("URL_BeforePassing", url);
        final StringRequest stringRequest = new StringRequest(Request.Method.GET, url,new Response.Listener<String>() {
            @Override
            public void onResponse(String response) {
                try {
                    JSONObject object = new JSONObject(response);
                    System.out.println(response);
                    JSONArray jsonArray = object.getJSONArray("data");
                    System.out.println(jsonArray);
                    Log.i("URL_INSIDE", "Entry_MAde");
                    paymentEntry();

                } catch (JSONException e) {
                    e.printStackTrace();
                }
            }
        }, new Response.ErrorListener() {
            @Override
            public void onErrorResponse(VolleyError error) {
                error.printStackTrace();
            }
        } );

        RequestQueue requestQueue = Volley.newRequestQueue(getApplicationContext());
        requestQueue.add(stringRequest);

        /*Clear cart*/
        dataHelper.flushTable();

        Log.i("BookingActivity", "CartTableDeleted");

    }

    void paymentEntry() {


        /*today userid amount transaction id*/

        String url = ListURL.INSERT_PAYMENT_URL;

        final String dateString = DataTransferHelper.dateOfBooking;

        SharedPreferenceHelper helper = new SharedPreferenceHelper(getApplicationContext());
        final String userId = helper.getUserId();
        String transactionId = "";
        Random rand = new Random();

        // Generate random integers in range 0 to 999
        for (int i=0;i<10;i++) {
            transactionId+=String.valueOf(rand.nextInt(10));
        }


        final String finalTransactionId = transactionId;
        StringRequest stringRequest = new StringRequest(Request.Method.POST, url, new Response.Listener<String>() {

            @Override
            public void onResponse(String response) {

                try {
                    JSONObject jsonObject = new JSONObject(response);
                    String s = jsonObject.getString("success");
                    String m = jsonObject.getString("message");
                    System.out.println("If Message :" + m);

                        if (s.equals("1")){
                            Log.i("PaymentEntry", "Made");
                        }else{
                            Toast.makeText(getApplicationContext(), "Error Occured!!!", Toast.LENGTH_LONG).show();
                        }

                } catch (JSONException e) {
                    e.printStackTrace();
                }

            }
        }, new Response.ErrorListener() {
            @Override
            public void onErrorResponse(VolleyError error) {
                Toast.makeText(getApplicationContext(), error.getMessage(), Toast.LENGTH_SHORT).show();
            }
        }){
            @Override
            protected Map<String, String> getParams() throws AuthFailureError {
                Map<String, String> params = new HashMap<>();

                params.put("date", dateString);
                params.put("user_id", userId);
                params.put("amount", phone);
                params.put("transaction_id", finalTransactionId);


                return params;
            }
        };

        VolleySingleton.getInstance(getApplicationContext()).addToRequestQueue(stringRequest);


    }



}
